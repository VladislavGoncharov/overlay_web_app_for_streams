<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <meta charset="UTF-8">
    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css} "/>
    <script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}"></script>

    <title>Title</title>
</head>
<body>
<div th:insert="fragments/nav :: nav"></div>
<div class="container" id="container" style="width: 60vw">

    <table>
        <thead>
        <tr>
            <td colspan="5">
                <div style="display: block">
                    <img style="width: 100%;margin-bottom: 15px" th:src="@{/image/gifka.gif }" alt="...">
                </div>
            </td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td colspan="4">
                <div class="container">
                    <div class="row row-cols-auto justify-content-around " style="margin: auto; padding: 5px">
                        <div class="col" style="padding: 0" th:each="pic : ${listPicture}">
                            <div class="card text-white" style="border: transparent">
                                <img class="card-img" style="width: 5vw"
                                     th:src="@{/image/character-small/{img} (img=${pic.addressOfSmallPicture})}"
                                     alt="persName" src="#">
                                <div class="card-img-overlay " style="padding: 0;font-size: 0.7vw;text-align: center">
                                    <div class="card-text" style="position: relative;bottom: -5.5vw;margin: auto;"
                                         th:text="${T(com.vladislavgoncharov.overlaywebappforstreams.dto.UserDTO)
                                         .getUsername(pic,listUsers)}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </td>
            <td>
                <div class="vstack">
                    <div style="margin: auto">
                        <table style="text-align: center">
                            <th:block th:each="user : ${listUsers}">
                                <tr>
                                    <td>
                                        <img style="height:7vw"
                                             th:src="@{/image/character-big/{img} (img=${user.picture.addressOfBigPicture})}"
                                             th:alt="${user.picture.addressOfBigPicture}">
                                    </td>
                                    <td>
                                        <span>
                                            <div>
                                                <img style="height: 3vw"
                                                     th:src="@{/image/rank/{img} (img=${user.addressRank})}"
                                                     th:alt="${user.addressRank}">
                                            </div>
                                            <div>
                                                <img style="height: 1.2vw"
                                                     th:src="@{/image/drops/{img} (img=${user.addressDrop})}"
                                                     th:alt="${user.addressDrop}">
                                            </div>
                                        </span>
                                        <a sec:authorize="hasAuthority('ADMIN')" th:text="${user.username}"
                                           th:href="@{/admin/{username} (username = ${user.username})}"
                                           class="link-dark"></a>
                                        <div sec:authorize="!hasAuthority('ADMIN')" th:text="${user.username}"></div>
                            </th:block>
                        </table>

                    </div>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script th:inline="javascript">
    if ([[${valueSwitcherOverlay}]]) document.getElementById('container').style.display = "block";
    else document.getElementById('container').style.display = "none";

</script>
<script>
     setInterval(function(){
         if (isUpdateDB()){
             valueUpdateDBFalse();
             location.reload();
         }
     }, 1000);

    function isUpdateDB() {
        let result;
        $.ajax({
            type: 'POST',
            url: 'is_update_db',
            async: false,
            success: function (request) {
                result = request;
            }
        });
        return result;
    }

    function valueUpdateDBFalse() {
        $.ajax({
            type: 'POST',
            url: 'value_update_db_false',
            async: false
        });
    }


</script>
</body>
</html>